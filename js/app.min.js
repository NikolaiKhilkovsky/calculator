
"use strict";var calculatorApp=angular.module("calculatorApp",[]);calculatorApp.constant("buttons",["7","8","9","←","C","4","5","6","×","÷","1","2","3","+","-","0",".","(",")","="]);calculatorApp.constant("reg",{regOpenBracket:/\(/g,regCloseBracket:/\)/g,regOpenBracketIsLast:/\($/,regExpInBrackets:/(\([^()]+\))/,regIsCalculated:/\s=\s\-?[0-9]+\.?[0-9]*$/,regOperatorIsLast:/(\s[+-×÷]\s)$/,regMinusIsLast:/\-$/,regDotIsLast:/(\.)$/});calculatorApp.service("result",["reg",function(a){return{backSpace:function(b){return a.regIsCalculated.test(b)?"":b.replace(/[()-]$|(\s[+-×÷]\s)$|[0-9.]$/,"")},update:function(f,c){var b="";if((a.regIsCalculated.test(f)||f=="0")&&/[0-9]|\.|\(/.test(c)){f=""}switch(c){case"+":case"-":case"×":case"÷":case"=":if(a.regIsCalculated.test(f)){f=f.replace(/^.+=\s/,"")}f=f.replace(a.regMinusIsLast,"");if(c!="-"){f=f.replace(a.regDotIsLast,"");f=f==""?"0":f.replace(a.regOperatorIsLast,"")}if(c=="-"){if(f=="0"||f==""||/\($/.test(f)){f=f=="0"?"":f;b=c}else{if(a.regOperatorIsLast.test(f)){b=c}else{f=f.replace(a.regDotIsLast,"");b=" "+c+" "}}}else{b=a.regOpenBracketIsLast.test(f)?"":" "+c+" "}break;case"(":if(a.regOperatorIsLast.test(f)||a.regMinusIsLast.test(f)||a.regOpenBracketIsLast.test(f)||f==""){b=c}break;case")":var e=a.regOpenBracket.test(f)?f.match(a.regOpenBracket).length:0;var d=a.regCloseBracket.test(f)?f.match(a.regCloseBracket).length:0;if(e>d&&/([0-9]+|\)|\.)$/g.test(f)){f=f.replace(a.regDotIsLast,"");b=c}break;case"0":if(f!="0"&&!/\)$/.test(f)){b=c}break;case".":if(f==""||/\s$/.test(f)||/\($/.test(f)||a.regMinusIsLast.test(f)){b="0"+c}else{if(!/\.[0-9]*$/.test(f)&&!/\)$/.test(f)){b=c}}break;default:if(!/\)$/.test(f)){b=c}}return f+b}}}]);calculatorApp.service("calculate",["reg","result",function(b,a){return{_checkExp:function(e){var c=b.regOpenBracket.test(e),d=b.regCloseBracket.test(e);b.regOpenBracket.lastIndex=0;b.regCloseBracket.lastIndex=0;if(e==""||b.regIsCalculated.test(e)||b.regOperatorIsLast.test(e)||b.regMinusIsLast.test(e)||b.regDotIsLast.test(e)){return false}if(c&&!d){return false}if(c&&d&&e.match(b.regOpenBracket).length!=e.match(b.regCloseBracket).length){return false}if(!c&&!/[0-9]\s[+-×÷]\s[0-9]*.?[0-9]+/g.test(e)){return false}if(c&&!/\s[+-×÷]\s/g.test(e)){return false}return true},_calcSimpleExp:function(g){var d,c,h;g=g.replace("(","").replace(")","").split(" ");while(g.length>1){if(g.indexOf("×")!=-1||g.indexOf("÷")!=-1){for(var e=0;e<g.length;e++){if(g[e]=="×"||g[e]=="÷"){f(e)}}}else{f(1)}}function f(j){if(g[j-1]=="Infinity"||g[j+1]=="Infinity"){g[j-1]="Infinity"}else{c=g[j-1].split(".");h=g[j+1].split(".");if(c[1]&&h[1]){c[1]=""+c[1];h[1]=""+h[1];d=Math.pow(10,c[1].length>h[1].length?c[1].length:h[1].length)}else{if(c[1]){c[1]=""+c[1];d=Math.pow(10,c[1].length)}else{if(h[1]){h[1]=""+h[1];d=Math.pow(10,h[1].length)}else{d=1}}}switch(g[j]){case"×":g[j-1]=""+((parseFloat(g[j-1])*d)*(parseFloat(g[j+1])*d))/(d*d);break;case"÷":g[j-1]=g[j+1]=="0"?"Infinity":(""+((parseFloat(g[j-1])*d)/(parseFloat(g[j+1])*d)));break;case"+":g[j-1]=""+((parseFloat(g[j-1])*d)+(parseFloat(g[j+1])*d))/d;break;case"-":g[j-1]=""+((parseFloat(g[j-1])*d)-(parseFloat(g[j+1])*d))/d;break}}g.splice(j,2)}return g[0].toString()},cEval:function(f,c){var d="",e=false;if(this._checkExp(f)){d=a.update(f,c);while(b.regExpInBrackets.test(f)){f=f.replace(b.regExpInBrackets,this._calcSimpleExp(b.regExpInBrackets.exec(f)[0]))}f=this._calcSimpleExp(f);d+=f;e=true}else{d=f}return{result:d,success:e}}}}]);calculatorApp.controller("CalculatorCtrl",["$scope","buttons","result","calculate",function(b,d,a,c){b.buttons=d;b.res="";b.historyItems=[];b.update=function(e){var f;switch(e){case"C":b.res="";break;case"←":b.res=a.backSpace(b.res);break;case"=":f=c.cEval(b.res,e);if(f.success){b.res=f.result;b.historyItems.push(b.res)}break;default:b.res=a.update(b.res,e)}}}]);